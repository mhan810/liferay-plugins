<?xml version="1.0" encoding="UTF-8"?>
<beans default-destroy-method="destroy"
       default-init-method="afterPropertiesSet"
       xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"
       xmlns:context="http://www.springframework.org/schema/context">

    <context:annotation-config/>

    <!-- ActiveMQ Component -->

    <bean id="activeMQComponent" class="com.liferay.portal.cloudservices.akka.spring.ActiveMQComponentFactoryBean">
        <property name="brokerURL" value="tcp://localhost:61616"/>
    </bean>

    <!-- Gateway system -->

    <bean id="gatewaySystem" class="com.liferay.portal.cloudservices.akka.spring.ActorSystemFactoryBean">
        <property name="name" value="gatewaySystem"/>
        <property name="camelComponents">
            <map>
               <entry key="activeMQ" value-ref="activeMQComponent"/>
            </map>
        </property>
        <property name="typeConverters">
            <map>
                <entry key="com.liferay.portal.cloudservices.messaging.HandShakeMessage" value-ref="messageConverter"/>
                <entry key="com.liferay.portal.cloudservices.messaging.HeartBeatMessage" value-ref="messageConverter"/>
                <entry key="com.liferay.portal.cloudservices.messaging.MetricsMessage" value-ref="messageConverter"/>
                <entry key="com.liferay.portal.cloudservices.messaging.CommandRequestMessage" value-ref="messageConverter"/>
                <entry key="com.liferay.portal.cloudservices.messaging.CommandResponseMessage" value-ref="messageConverter"/>
            </map>
        </property>
    </bean>

    <bean id="messageConverter" class="com.liferay.portal.cloudservices.messaging.MessageConverter"/>

    <!-- Handshake message -->

    <bean id="handShakeProducerActor" class="com.liferay.portal.cloudservices.akka.spring.CamelActorFactoryBean">
        <property name="actorName" value="handShakeProducerActor"/>
        <property name="actorClassName" value="com.liferay.portal.cloudservices.akka.actor.CamelProducerActor"/>
        <property name="actorSystem" ref="gatewaySystem"/>
        <property name="endpointUri" value="activemq:queue:cloud.handshake"/>
    </bean>

    <bean id="handShakeProcess" class="com.liferay.portal.cloudservices.gateway.service.impl.HandShakeServiceImpl" init-method="init" depends-on="handShakeProducerActor"/>

    <!-- HeartBeat message -->

    <bean id="heartBeatProducerActor" class="com.liferay.portal.cloudservices.akka.spring.CamelActorFactoryBean">
        <property name="actorName" value="heartBeatProducerActor"/>
        <property name="actorClassName" value="com.liferay.portal.cloudservices.akka.actor.CamelProducerActor"/>
        <property name="actorSystem" ref="gatewaySystem"/>
        <property name="endpointUri" value="activemq:queue:cloud.heartbeat"/>
        <property name="isOneWay" value="true"/>
    </bean>

    <bean id="heartBeatActor" class="com.liferay.portal.cloudservices.akka.spring.ActorFactoryBean">
        <property name="actorName" value="heartBeatActor"/>
        <property name="actorClassName" value="com.liferay.portal.cloudservices.gateway.actor.HeartBeatActor"/>
        <property name="actorSystem" ref="gatewaySystem"/>
    </bean>

    <bean id="heartBeatScheduler" class="com.liferay.portal.cloudservices.akka.spring.SchedulerFactoryBean">
        <property name="actorSystem" ref="gatewaySystem"/>
        <property name="actor" ref="heartBeatActor"/>
        <property name="message" value="#{T(com.liferay.portal.cloudservices.messaging.Message).SCHEDULER_HEARTBEAT_MESSAGE}"/>
        <property name="delay" value="1"/>
        <property name="delayUnit" value="#{T(java.util.concurrent.TimeUnit).MINUTES}"/>
        <property name="frequency" value="1"/>
        <property name="frequencyUnit" value="#{T(java.util.concurrent.TimeUnit).MINUTES}"/>
    </bean>

    <!-- Metrics message -->

    <bean id="metricsProducerActor" class="com.liferay.portal.cloudservices.akka.spring.CamelActorFactoryBean">
        <property name="actorName" value="metricsProducerActor"/>
        <property name="actorClassName" value="com.liferay.portal.cloudservices.akka.actor.CamelProducerActor"/>
        <property name="actorSystem" ref="gatewaySystem"/>
        <property name="endpointUri" value="activemq:queue:cloud.metrics"/>
        <property name="isOneWay" value="true"/>
    </bean>

    <bean id="metricsActor" class="com.liferay.portal.cloudservices.akka.spring.ActorFactoryBean">
        <property name="actorName" value="metricsActor"/>
        <property name="actorClassName" value="com.liferay.portal.cloudservices.gateway.actor.MetricsActor"/>
        <property name="actorSystem" ref="gatewaySystem"/>
    </bean>

    <bean id="metricsScheduler" class="com.liferay.portal.cloudservices.akka.spring.SchedulerFactoryBean">
        <property name="actorSystem" ref="gatewaySystem"/>
        <property name="actor" ref="metricsActor"/>
        <property name="message" value="#{T(com.liferay.portal.cloudservices.messaging.Message).SCHEDULER_METRICS_MESSAGE}"/>
        <property name="delay" value="0"/>
        <property name="delayUnit" value="#{T(java.util.concurrent.TimeUnit).SECONDS}"/>
        <property name="frequency" value="10"/>
        <property name="frequencyUnit" value="#{T(java.util.concurrent.TimeUnit).SECONDS}"/>
    </bean>

    <bean id="metricsService" class="com.liferay.portal.cloudservices.gateway.service.impl.MetricsServiceImpl"/>

    <!-- Command message -->

    <bean id="commandConsumerActor" class="com.liferay.portal.cloudservices.akka.spring.CamelActorFactoryBean">
        <property name="actorSystem" ref="gatewaySystem"/>
        <property name="actorName" value="commandConsumerActor"/>
        <property name="actor" ref="commandActor"/>
        <property name="actorClassName" value="com.liferay.portal.cloudservices.akka.actor.CamelConsumerActor"/>
        <property name="endpointUri" value="activemq:queue:cloud.command"/>
    </bean>

    <bean id="commandActor" class="com.liferay.portal.cloudservices.akka.spring.ActorFactoryBean">
        <property name="actorName" value="commandActor"/>
        <property name="actorClassName" value="com.liferay.portal.cloudservices.gateway.actor.CommandActor"/>
        <property name="actorSystem" ref="gatewaySystem"/>
    </bean>

    <bean id="commandService" class="com.liferay.portal.cloudservices.gateway.service.impl.CommandServiceImpl"/>
</beans>